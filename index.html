<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—¬ìš¸ì´ˆ ê³¼í•™ì‹¤ ë¬¼í’ˆ ê²€ìƒ‰</title>
    
    <!-- 1. Tailwind CSS (ìŠ¤íƒ€ì¼) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. í°íŠ¸ ì„¤ì • -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        .animate-fade-in-down { animation: fadeInDown 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <!-- 3. React ë° í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì •ì„ ìœ„í•œ Import Map -->
    <!-- ì˜¤ë¥˜ í•´ê²°: lucide-react ë²„ì „ì„ ì•ˆì •ì ì¸ 0.263.1ë¡œ ê³ ì • -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1",
            "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
            "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
            "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
        }
    }
    </script>
    
    <!-- 4. Babel (JSX ì½”ë“œë¥¼ ë¸Œë¼ìš°ì €ê°€ ì´í•´í•˜ë„ë¡ ë³€í™˜) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <!-- 5. ì„ ìƒë‹˜ì´ ì‘ì„±í•˜ì‹  React ì½”ë“œ -->
    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        
        // ì˜¤ë¥˜ í•´ê²°: ì•„ì´ì½˜ ì´ë¦„ì„ 0.263.1 ë²„ì „ì— ë§ê²Œ ë³€ê²½
        // CloudUpload -> UploadCloud
        // Pencil -> Edit2
        // Trash -> Trash2
        import { Search, MapPin, Package, Plus, Minus, Edit2, Trash2, PlusCircle, Filter, Beaker, X, Save, TestTube, Database, UploadCloud, RefreshCw, AlertTriangle, FileSpreadsheet } from 'lucide-react';
        
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
        import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot, writeBatch } from 'firebase/firestore';

        // --- Firebase ì„¤ì • ---
        const firebaseConfig = {
            apiKey: "AIzaSyBP6oC0RH728IWwpTZxSGTRiS8ivVqdhjs",
            authDomain: "yeoulsciencelab.firebaseapp.com",
            projectId: "yeoulsciencelab",
            storageBucket: "yeoulsciencelab.firebasestorage.app",
            messagingSenderId: "353295377528",
            appId: "1:353295377528:web:83dd4c370c48e49e47f98d"
        };

        // ì•± ì´ˆê¸°í™”
        let app, auth, db;
        let initError = null;
        const PROJECT_ID = "yeoulsciencelab"; 

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            console.warn("Firebase initialization failed:", e);
            initError = e.message;
        }

        const App = () => {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('search');
            const [searchTerm, setSearchTerm] = useState('');
            const [showAddForm, setShowAddForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [newItem, setNewItem] = useState({ location: '', item: '', quantity: 0, room: '2ê³¼í•™ì‹¤' });
            const [editItemData, setEditItemData] = useState({});
            const [roomFilter, setRoomFilter] = useState('all');
            const [inventory, setInventory] = useState([]);
            const [loading, setLoading] = useState(true);
            const [uploading, setUploading] = useState(false);
            const [isOffline, setIsOffline] = useState(!!initError || !app);
            const [connectionError, setConnectionError] = useState(null);

            // --- ì´ˆê¸° ë°ì´í„° (ë°±ì—…ìš©) ---
            const initialInventory = [
                { location: '1ê³¼êµ ì•ˆì „ë³´ê´€í•¨', item: 'êµ¬ê¸‰ìƒì', quantity: 1, room: '1ê³¼í•™ì‹¤' },
                { location: '1ê³¼êµ ì•ˆì „ë³´ê´€í•¨', item: 'ë°©ì§„ë§ˆìŠ¤í¬', quantity: 40, room: '1ê³¼í•™ì‹¤' },
                // ... (ë°ì´í„°ê°€ ê¸¸ì–´ ìƒëµë˜ì—ˆìŠµë‹ˆë‹¤. í•„ìš”ì‹œ ì„ ìƒë‹˜ì˜ ì „ì²´ ë°ì´í„°ë¥¼ ì´ê³³ì— ì±„ì›Œë„£ìœ¼ì„¸ìš”)
                { location: '2ê³¼êµ 2', item: 'ë¼í…ìŠ¤ì‹¤í—˜ìš© ì¥ê°‘ M', quantity: 450, room: '2ê³¼í•™ì‹¤' }
            ];

            // --- Auth & Data Sync ---
            useEffect(() => {
                if (!app) {
                    setInventory([]); // DBì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ í˜¹ì€ ì´ˆê¸°ê°’
                    setLoading(false);
                    return;
                }

                const initAuth = async () => {
                    try {
                        await signInAnonymously(auth);
                    } catch (err) {
                        console.error("Auth failed:", err);
                        setConnectionError("ë¡œê·¸ì¸ ì‹¤íŒ¨: Firebase ì„¤ì • í™•ì¸ í•„ìš”");
                        setIsOffline(true);
                    }
                };
                initAuth();
                const unsubscribe = onAuthStateChanged(auth, setUser);
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user || !db) return;

                // ê²½ë¡œ: artifacts/yeoulsciencelab/public/data/inventory
                const collectionRef = collection(db, 'artifacts', PROJECT_ID, 'public', 'data', 'inventory');
                
                const unsubscribe = onSnapshot(collectionRef, (snapshot) => {
                    const items = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    items.sort((a, b) => {
                        if (a.room !== b.room) return a.room.localeCompare(b.room);
                        return a.item.localeCompare(b.item);
                    });
                    
                    setInventory(items);
                    setLoading(false);
                    setConnectionError(null);
                }, (error) => {
                    console.error("Error fetching inventory:", error);
                    setLoading(false);
                    
                    if (error.code === 'permission-denied') {
                        setConnectionError("ê¶Œí•œ ì˜¤ë¥˜: Firestore ê·œì¹™ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                    } else {
                        setConnectionError(`ì—°ê²° ì˜¤ë¥˜: ${error.message}`);
                    }
                });

                return () => unsubscribe();
            }, [user]);

            // --- CRUD Operations ---
            const addItem = async () => {
                if (newItem.item && newItem.location) {
                    if (user && db && !connectionError) {
                        try {
                            const collectionRef = collection(db, 'artifacts', PROJECT_ID, 'public', 'data', 'inventory');
                            await addDoc(collectionRef, newItem);
                        } catch (e) {
                            alert("ì €ì¥ ì‹¤íŒ¨: " + e.message);
                            return;
                        }
                    } else {
                        // ì˜¤í”„ë¼ì¸/ì—ëŸ¬ ì‹œ ë¡œì»¬ì—ë§Œ ì¶”ê°€
                        setInventory(prev => [...prev, { ...newItem, id: Date.now().toString() }]);
                    }
                    setNewItem({ location: '', item: '', quantity: 0, room: '2ê³¼í•™ì‹¤' });
                    setShowAddForm(false);
                }
            };

            const deleteItem = async (id) => {
                if (window.confirm('ì´ ë¬¼í’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    if (user && db && !connectionError) {
                        const docRef = doc(db, 'artifacts', PROJECT_ID, 'public', 'data', 'inventory', id);
                        await deleteDoc(docRef);
                    } else {
                        setInventory(prev => prev.filter(item => item.id !== id));
                    }
                }
            };

            const adjustQuantity = async (id, currentQty, delta) => {
                const newQty = Math.max(0, (currentQty || 0) + delta);
                if (user && db && !connectionError) {
                    const docRef = doc(db, 'artifacts', PROJECT_ID, 'public', 'data', 'inventory', id);
                    await updateDoc(docRef, { quantity: newQty });
                } else {
                    setInventory(prev => prev.map(item => item.id === id ? { ...item, quantity: newQty } : item));
                }
            };

            const saveEditing = async (id) => {
                if (user && db && !connectionError) {
                    const docRef = doc(db, 'artifacts', PROJECT_ID, 'public', 'data', 'inventory', id);
                    await updateDoc(docRef, editItemData);
                } else {
                    setInventory(prev => prev.map(item => item.id === id ? editItemData : item));
                }
                setEditingId(null);
            };

            const downloadExcel = () => {
                if (inventory.length === 0) {
                    alert("ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }
                const headers = ['ê³¼í•™ì‹¤', 'ìœ„ì¹˜', 'ë¬¼í’ˆëª…', 'ìˆ˜ëŸ‰'];
                const rows = inventory.map(item => [
                    item.room, item.location, item.item, item.quantity
                ]);
                const csvContent = [
                    headers.join(','),
                    ...rows.map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','))
                ].join('\n');
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', `ê³¼í•™ì‹¤_ì¬ê³ í˜„í™©_${new Date().toLocaleDateString()}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const uploadInitialData = async () => {
                // ì´ ë¶€ë¶„ì€ ë°ì´í„°ê°€ ë„ˆë¬´ ë§ì•„ì§ˆ ìˆ˜ ìˆì–´ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì‹¤í–‰í•˜ë„ë¡ í•©ë‹ˆë‹¤.
                // ì„ ìƒë‹˜ ì½”ë“œì˜ ë¡œì§ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.
                if (!user || !db) return;
                setUploading(true);
                try {
                     const batch = writeBatch(db);
                     const collectionRef = collection(db, 'artifacts', PROJECT_ID, 'public', 'data', 'inventory');
                     
                     // ì£¼ì˜: initialInventoryê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
                     alert("ë°ì´í„° ì—…ë¡œë“œ ê¸°ëŠ¥ì€ ì½”ë“œ ë‚´ì— ì „ì²´ ë°ì´í„°ê°€ ìˆì–´ì•¼ ì‘ë™í•©ë‹ˆë‹¤.");
                } catch (e) {
                     alert("ì˜¤ë¥˜: " + e.message);
                } finally {
                     setUploading(false);
                }
            };

            const startEditing = (item) => {
                setEditingId(item.id);
                setEditItemData({ ...item });
            };
            const cancelEditing = () => {
                setEditingId(null);
                setEditItemData({});
            };

            // --- ì‹¤í—˜ ëª©ë¡ ë°ì´í„° ---
            const experiments = [
                { name: 'ë‹¨ì› í‰ê°€', grade: '3-6', tools: ['ìŠ¤í‹°ì»¤', 'ê°€ìœ„'] },
                { name: 'ë‚˜ì¹¨ë°˜ ë§Œë“¤ê¸°', grade: '3', tools: ['ë‚˜ì¹¨ë°˜', 'ë§‰ëŒ€ìì„'] },
                { name: 'ìì„ ë†€ì´', grade: '3', tools: ['ë§‰ëŒ€ìì„', 'ìì„6ì¢…ì„¸íŠ¸'] },
                { name: 'ê·¸ë¦¼ì ê´€ì°°', grade: '3', tools: ['ì†ì „ë“±', 'ìŠ¤íƒ ë“œ'] },
                { name: 'ì•¡ì²´ ê´€ì°°', grade: '4', tools: ['ë¹„ì»¤', 'ìŠ¤í¬ì´íŠ¸', 'í˜íŠ¸ë¦¬ì ‘ì‹œ'] },
                { name: 'í˜¼í•©ë¬¼ ë¶„ë¦¬', grade: '4', tools: ['ë¹„ì»¤', 'ê¹”ëŒ€ê¸°', 'ê±°ë¦„ì¢…ì´', 'ìœ ë¦¬ë§‰ëŒ€'] },
                { name: 'ìš©í•´ì™€ ìš©ì•¡', grade: '5', tools: ['ë¹„ì»¤', 'ìœ ë¦¬ë§‰ëŒ€', 'ìŠ¤í¬ì´íŠ¸', 'í˜íŠ¸ë¦¬ì ‘ì‹œ'] },
                { name: 'ì‚°ê³¼ ì—¼ê¸°', grade: '5', tools: ['ë¹„ì»¤', 'PHë¯¸í„°ê¸°', 'ìŠ¤í¬ì´íŠ¸', 'ì‹œí—˜ê´€'] },
                { name: 'ì „ê¸°íšŒë¡œ', grade: '6', tools: ['ì „ì§€', 'ì „ì§€ë¼ìš°ê°œ', 'ì§‘ê²Œì „ì„ ', 'ê¼¬ë§ˆì „êµ¬', 'ìŠ¤ìœ„ì¹˜'] },
                { name: 'ì „ìì„', grade: '6', tools: ['ì „ìì„ë§Œë“¤ê¸° ì¬ë£Œ', 'ì „ì§€', 'ë‚˜ì¹¨ë°˜'] },
                { name: 'ë Œì¦ˆ', grade: '6', tools: ['ë³¼ë¡ë Œì¦ˆ', 'ì˜¤ëª©ë Œì¦ˆ', 'í‰ë©´ë Œì¦ˆ', 'ë ˆì´ì €í¬ì¸í„°'] },
                { name: 'ë¹›ì˜ êµ´ì ˆ', grade: '6', tools: ['ì‚¼ê°í”„ë¦¬ì¦˜', 'ë ˆì´ì €í¬ì¸í„°', 'ë³¼ë¡ë Œì¦ˆ'] },
                { name: 'ì—°ì†Œ', grade: '6', tools: ['ì•Œì½œë¨í”„', 'ì‚¼ë°œì´', 'ì„¸ë¼ë¯¹ê·¸ë¬¼ë§', 'ë¹„ì»¤', 'ì§‘ê¸°ë³‘'] },
                { name: 'ê¸°ì²´ ë°œìƒ', grade: '6', tools: ['ì‚¼ê°í”Œë¼ìŠ¤í¬', 'ì‹œí—˜ê´€', 'ê³ ë¬´ë§ˆê°œ', 'ã„±ììœ ë¦¬ê´€', 'ì§‘ê¸°ë³‘'] },
                { name: 'í˜„ë¯¸ê²½ ê´€ì°°', grade: '6', tools: ['ê´‘í•™í˜„ë¯¸ê²½', 'í˜íŠ¸ë¦¬ì ‘ì‹œ', 'ìŠ¬ë¼ì´ë“œê¸€ë¼ìŠ¤', 'ìŠ¤í¬ì´íŠ¸'] },
                { name: 'í˜¸í¡', grade: '6', tools: ['í˜¸í¡ìš´ë™ì‹¤í—˜ëª¨í˜•', 'íëª¨í˜•'] },
                { name: 'ì‹¬ì¥', grade: '6', tools: ['íŒí”„', 'ì²­ì§„ê¸°'] },
                { name: 'ë¼ˆì™€ ê·¼ìœ¡', grade: '6', tools: ['ì¸ì²´ëª¨í˜•', 'íŒ”ê·¼ìœ¡ëª¨í˜•'] },
                { name: 'ìš©ìˆ˜ì² ', grade: '5', tools: ['ìš©ìˆ˜ì² ', 'ë¬´ê²Œì¶”', 'ì'] },
                { name: 'ì˜¨ë„ê³„', grade: '3-6', tools: ['ì•Œì½”ì˜¬ì˜¨ë„ê³„', 'ë””ì§€í„¸ì˜¨ë„ê³„'] },
                { name: 'íƒœì–‘ ê´€ì°°', grade: '6', tools: ['íƒœì–‘ê³ ë„ì¸¡ì •ê¸°', 'ë‚˜ì¹¨ë°˜'] },
                { name: 'ì§€êµ¬ì™€ ë‹¬', grade: '6', tools: ['ì§€êµ¬ì˜', 'ì§€êµ¬+ë‹¬ ê³µì „ëª¨í˜•'] },
                { name: 'ë¬¼ì˜ ìƒíƒœë³€í™”', grade: '3', tools: ['ë¹„ì»¤', 'ì•Œì½œë¨í”„', 'ì‚¼ë°œì´', 'ì˜¨ë„ê³„'] },
                { name: 'ë¬¼ì²´ì˜ ë¬´ê²Œ', grade: '3', tools: ['ì „ìì €ìš¸', 'ìš©ìˆ˜ì² ì €ìš¸'] },
                { name: 'ìì„', grade: '3', tools: ['ë§‰ëŒ€ìì„', 'ìì„6ì¢…ì„¸íŠ¸', 'ë‚˜ì¹¨ë°˜'] }
            ];

            const findToolsForExperiment = (experimentName) => {
                const normalize = (str) => str.toLowerCase().replace(/\s+/g, '');
                const term = normalize(experimentName);
                const exp = experiments.find(e => {
                    const normName = normalize(e.name);
                    return normName.includes(term) || term.includes(normName);
                });

                if (!exp) return null;
                
                const tools = exp.tools;
                const foundItems = [];
                
                tools.forEach(tool => {
                    const matches = inventory.filter(item => 
                        item.item.toLowerCase().includes(tool.toLowerCase()) || 
                        tool.toLowerCase().includes(item.item.toLowerCase())
                    );
                    foundItems.push(...matches);
                });
                
                const uniqueItems = Array.from(new Set(foundItems.map(a => a.id)))
                    .map(id => foundItems.find(a => a.id === id));
                
                return { experiment: exp, items: uniqueItems };
            };

            const filteredInventory = useMemo(() => {
                if (roomFilter === 'all') return inventory;
                return inventory.filter(item => item.room === roomFilter);
            }, [inventory, roomFilter]);

            const searchResults = useMemo(() => {
                if (!searchTerm.trim()) return { type: 'none', data: [] };
                
                const expResult = findToolsForExperiment(searchTerm);
                if (expResult) {
                    return { type: 'experiment', data: expResult };
                }
                
                const term = searchTerm.toLowerCase();
                const items = filteredInventory.filter(item => 
                    item.item.toLowerCase().includes(term) || item.location.toLowerCase().includes(term)
                );
                
                return { type: 'items', data: items };
            }, [searchTerm, filteredInventory]);

            // --- ì»´í¬ë„ŒíŠ¸ë“¤ ---
            const InventoryCard = ({ item, highlight = false }) => (
                <div key={item.id} className={`bg-white rounded-xl shadow-sm border-l-4 p-5 transition-all hover:shadow-md ${item.room === '1ê³¼í•™ì‹¤' ? 'border-green-500' : 'border-blue-500'} ${highlight ? 'ring-2 ring-indigo-200' : ''}`}>
                    {editingId === item.id ? (
                        <div className="space-y-3 animate-fade-in">
                            <div className="grid grid-cols-2 gap-2">
                                <div>
                                    <label className="text-xs text-gray-500">ë¬¼í’ˆëª…</label>
                                    <input type="text" value={editItemData.item} onChange={(e) => setEditItemData({...editItemData, item: e.target.value})} className="w-full border rounded p-1 text-sm" />
                                </div>
                                <div>
                                    <label className="text-xs text-gray-500">ìœ„ì¹˜</label>
                                    <input type="text" value={editItemData.location} onChange={(e) => setEditItemData({...editItemData, location: e.target.value})} className="w-full border rounded p-1 text-sm" />
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="flex-1">
                                    <label className="text-xs text-gray-500">ìˆ˜ëŸ‰</label>
                                    <input type="number" value={editItemData.quantity} onChange={(e) => setEditItemData({...editItemData, quantity: parseInt(e.target.value) || 0})} className="w-full border rounded p-1 text-sm" />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs text-gray-500">ê³¼í•™ì‹¤</label>
                                    <select value={editItemData.room} onChange={(e) => setEditItemData({...editItemData, room: e.target.value})} className="w-full border rounded p-1 text-sm">
                                        <option value="1ê³¼í•™ì‹¤">1ê³¼í•™ì‹¤</option>
                                        <option value="2ê³¼í•™ì‹¤">2ê³¼í•™ì‹¤</option>
                                    </select>
                                </div>
                            </div>
                            <div className="flex gap-2 pt-2">
                                <button onClick={() => saveEditing(item.id)} className="flex-1 bg-green-600 text-white py-1 rounded text-sm flex items-center justify-center gap-1"><Save size={14}/> ì €ì¥</button>
                                <button onClick={cancelEditing} className="flex-1 bg-gray-300 text-gray-700 py-1 rounded text-sm flex items-center justify-center gap-1"><X size={14}/> ì·¨ì†Œ</button>
                            </div>
                        </div>
                    ) : (
                        <>
                            <div className="flex justify-between items-start mb-2">
                                <div>
                                    <span className={`inline-block px-2 py-1 rounded text-xs font-bold mb-1 ${item.room === '1ê³¼í•™ì‹¤' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}`}>
                                        {item.room}
                                    </span>
                                    <h3 className="text-lg font-bold text-gray-800">{item.item}</h3>
                                </div>
                                <div className="flex gap-1">
                                    <button onClick={() => startEditing(item)} className="p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-full transition-colors"><Edit2 size={16} /></button>
                                    <button onClick={() => deleteItem(item.id)} className="p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors"><Trash2 size={16} /></button>
                                </div>
                            </div>
                            <div className="flex items-center gap-2 text-gray-600 mb-4 text-sm">
                                <MapPin size={16} /><span>{item.location}</span>
                            </div>
                            <div className="flex items-center justify-between bg-gray-50 p-2 rounded-lg">
                                <span className="text-sm font-semibold text-gray-500 flex items-center gap-1"><Package size={16} /> ìˆ˜ëŸ‰</span>
                                <div className="flex items-center gap-3">
                                    <button onClick={() => adjustQuantity(item.id, item.quantity, -1)} className="w-7 h-7 flex items-center justify-center rounded-full bg-white border border-gray-200 text-gray-600 hover:border-indigo-500 hover:text-indigo-600 transition-colors shadow-sm"><Minus size={14} /></button>
                                    <span className={`font-bold w-8 text-center ${item.quantity < 5 ? 'text-red-500' : 'text-gray-800'}`}>{item.quantity}</span>
                                    <button onClick={() => adjustQuantity(item.id, item.quantity, 1)} className="w-7 h-7 flex items-center justify-center rounded-full bg-white border border-gray-200 text-gray-600 hover:border-indigo-500 hover:text-indigo-600 transition-colors shadow-sm"><Plus size={14} /></button>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-6 font-sans">
                    <div className="max-w-5xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 mb-6">
                            <div className="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
                                <div>
                                    <h1 className="text-2xl md:text-3xl font-extrabold text-slate-800 flex items-center gap-3">
                                        <span className="bg-indigo-600 text-white p-2 rounded-lg"><TestTube size={24}/></span>
                                        ì—¬ìš¸ì´ˆ ê³¼í•™ì‹¤ ë¬¼í’ˆ ê²€ìƒ‰
                                    </h1>
                                    <div className="flex items-center gap-2 mt-2">
                                        <p className="text-slate-500 ml-1">ë¬¼í’ˆëª…, ìœ„ì¹˜, ë˜ëŠ” ì‹¤í—˜ëª…ì„ ê²€ìƒ‰í•˜ì„¸ìš”</p>
                                        {isOffline ? (
                                            <div className="px-2 py-0.5 rounded text-xs font-bold flex items-center gap-1 bg-gray-200 text-gray-600">
                                                <Database size={10}/> ì˜¤í”„ë¼ì¸ ëª¨ë“œ
                                            </div>
                                        ) : (
                                            <div className={`px-2 py-0.5 rounded text-xs font-bold flex items-center gap-1 ${loading ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700'}`}>
                                                {loading ? <RefreshCw className="animate-spin" size={10}/> : <Database size={10}/>}
                                                {loading ? 'DB ì—°ê²°ì¤‘...' : 'ì˜¨ë¼ì¸ ì—°ë™ë¨'}
                                            </div>
                                        )}
                                    </div>
                                </div>
                                <div className="flex gap-2 bg-slate-100 p-1.5 rounded-xl self-start">
                                    <button onClick={() => setActiveTab('search')} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${activeTab === 'search' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}><Search size={16}/> ê²€ìƒ‰</button>
                                    <button onClick={() => setActiveTab('database')} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${activeTab === 'database' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}><Database size={16}/> ì „ì²´ DB</button>
                                    <button onClick={() => setActiveTab('experiments')} className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-bold transition-all ${activeTab === 'experiments' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}><Beaker size={16}/> ì‹¤í—˜ëª©ë¡</button>
                                </div>
                            </div>
                        </div>

                        {activeTab === 'search' && (
                            <div className="space-y-6">
                                <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                                    <div className="flex flex-col md:flex-row gap-4 mb-4">
                                        <div className="flex items-center gap-2 text-sm font-medium text-slate-600 min-w-fit"><Filter size={18} /> í•„í„°:</div>
                                        <div className="flex gap-2">
                                            <button onClick={() => setRoomFilter('all')} className={`px-4 py-2 rounded-full text-sm font-bold transition-colors border ${roomFilter === 'all' ? 'bg-slate-800 text-white border-slate-800' : 'bg-white text-slate-600 border-slate-200 hover:bg-slate-50'}`}>ì „ì²´</button>
                                            <button onClick={() => setRoomFilter('1ê³¼í•™ì‹¤')} className={`px-4 py-2 rounded-full text-sm font-bold transition-colors border ${roomFilter === '1ê³¼í•™ì‹¤' ? 'bg-green-600 text-white border-green-600' : 'bg-white text-slate-600 border-slate-200 hover:bg-green-50'}`}>1ê³¼í•™ì‹¤</button>
                                            <button onClick={() => setRoomFilter('2ê³¼í•™ì‹¤')} className={`px-4 py-2 rounded-full text-sm font-bold transition-colors border ${roomFilter === '2ê³¼í•™ì‹¤' ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-slate-600 border-slate-200 hover:bg-blue-50'}`}>2ê³¼í•™ì‹¤</button>
                                        </div>
                                    </div>
                                    <div className="relative mb-4">
                                        <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400" size={20} />
                                        <input type="text" placeholder="ì˜ˆ: ë¹„ì»¤, 1ê³¼êµ 1, ì „ê¸°íšŒë¡œ, ë Œì¦ˆ..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full pl-12 pr-4 py-4 text-lg bg-slate-50 border-2 border-slate-200 rounded-xl focus:border-indigo-500 focus:bg-white focus:outline-none transition-all placeholder:text-slate-400" />
                                    </div>
                                    <button onClick={() => setShowAddForm(!showAddForm)} className="w-full py-3 border-2 border-dashed border-indigo-200 text-indigo-600 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-indigo-50 transition-colors">
                                        {showAddForm ? <X size={20}/> : <PlusCircle size={20}/>}{showAddForm ? 'ë‹«ê¸°' : 'ìƒˆ ë¬¼í’ˆ ì§ì ‘ ì¶”ê°€í•˜ê¸°'}
                                    </button>
                                </div>
                                {showAddForm && (
                                    <div className="bg-white rounded-2xl shadow-lg border border-indigo-100 p-6 animate-fade-in-down">
                                        <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><span className="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600"><Plus size={18}/></span>ìƒˆ ë¬¼í’ˆ ë“±ë¡</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                            <div className="space-y-1"><label className="text-sm font-semibold text-slate-500">ë¬¼í’ˆëª…</label><input type="text" placeholder="ì˜ˆ: ë¹„ì»¤ 500ml" value={newItem.item} onChange={(e) => setNewItem({ ...newItem, item: e.target.value })} className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" /></div>
                                            <div className="space-y-1"><label className="text-sm font-semibold text-slate-500">ìœ„ì¹˜</label><input type="text" placeholder="ì˜ˆ: 1ê³¼êµ 3" value={newItem.location} onChange={(e) => setNewItem({ ...newItem, location: e.target.value })} className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" /></div>
                                            <div className="space-y-1"><label className="text-sm font-semibold text-slate-500">ë³´ê´€ ì¥ì†Œ</label><select value={newItem.room} onChange={(e) => setNewItem({ ...newItem, room: e.target.value })} className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 bg-white"><option value="1ê³¼í•™ì‹¤">1ê³¼í•™ì‹¤</option><option value="2ê³¼í•™ì‹¤">2ê³¼í•™ì‹¤</option></select></div>
                                            <div className="space-y-1"><label className="text-sm font-semibold text-slate-500">ì´ˆê¸° ìˆ˜ëŸ‰</label><input type="number" placeholder="0" value={newItem.quantity} onChange={(e) => setNewItem({ ...newItem, quantity: parseInt(e.target.value) || 0 })} className="w-full px-4 py-2 border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none" /></div>
                                        </div>
                                        <div className="flex gap-3"><button onClick={addItem} className="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-xl font-bold transition-colors">ë“±ë¡í•˜ê¸°</button><button onClick={() => { setShowAddForm(false); setNewItem({ location: '', item: '', quantity: 0, room: '2ê³¼í•™ì‹¤' }); }} className="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-3 rounded-xl font-bold transition-colors">ì·¨ì†Œ</button></div>
                                    </div>
                                )}
                                {searchTerm && searchResults.type !== 'none' ? (
                                    <div className="animate-fade-in">
                                        {searchResults.type === 'experiment' && (
                                            <div className="mb-6 bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-100 rounded-2xl p-6 shadow-sm">
                                                <div className="flex flex-col md:flex-row md:items-start gap-4">
                                                    <div className="p-3 bg-white rounded-full shadow-sm text-purple-600"><Beaker size={32} /></div>
                                                    <div className="flex-1">
                                                        <div className="flex flex-wrap items-center gap-2 mb-2"><h3 className="text-xl font-bold text-purple-900">{searchResults.data.experiment.name}</h3><span className="px-2 py-1 bg-purple-200 text-purple-800 text-xs font-bold rounded-full">{searchResults.data.experiment.grade}í•™ë…„</span></div>
                                                        <div className="bg-white/60 rounded-lg p-3 backdrop-blur-sm"><p className="text-sm font-semibold text-purple-800 mb-1">ğŸ” í•„ìš” ì‹¤í—˜ ë„êµ¬:</p><div className="flex flex-wrap gap-2">{searchResults.data.experiment.tools.map((tool, idx) => (<span key={idx} className="px-2 py-1 bg-white border border-purple-100 rounded-md text-sm text-purple-700 shadow-sm">{tool}</span>))}</div></div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        <div className="flex items-center justify-between mb-4 px-1"><h2 className="text-lg font-bold text-slate-700 flex items-center gap-2">{searchResults.type === 'experiment' ? <><Package size={20}/> ê´€ë ¨ ë¬¼í’ˆ ìœ„ì¹˜</> : <><Search size={20}/> ê²€ìƒ‰ ê²°ê³¼</>}<span className="ml-2 bg-slate-200 text-slate-700 px-2 py-0.5 rounded-full text-sm">{searchResults.data.items?.length || searchResults.data.length}ê±´</span></h2></div>
                                        {((searchResults.data.items || searchResults.data).length > 0) ? (
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">{(searchResults.data.items || searchResults.data).map((item) => (<InventoryCard key={item.id} item={item} highlight={true} />))}</div>
                                        ) : (
                                            <div className="text-center py-12 bg-white rounded-2xl border border-dashed border-slate-300"><div className="text-slate-300 mb-3 mx-auto flex justify-center"><Package size={48}/></div><p className="text-slate-500 font-medium">ê²€ìƒ‰ëœ ë¬¼í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p></div>
                                        )}
                                    </div>
                                ) : (!searchTerm && (<div className="text-center py-20 opacity-50"><div className="inline-block p-6 bg-white rounded-full shadow-sm mb-4"><Search size={48} className="text-indigo-200" /></div><h3 className="text-xl font-bold text-slate-400 mb-2">ë¬¼í’ˆì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”</h3><p className="text-slate-400">ì‹¤í—˜ ì´ë¦„ì´ë‚˜ ë„êµ¬ ì´ë¦„ì„ ì…ë ¥í•˜ë©´<br/>ìœ„ì¹˜ì™€ ì¬ê³ ë¥¼ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.</p></div>))}
                            </div>
                        )}

                        {activeTab === 'database' && (
                            <div className="space-y-6 animate-fade-in">
                                <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                                    <div className="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
                                        <h2 className="text-xl font-bold text-slate-800 flex items-center gap-2"><Database size={24} className="text-indigo-600"/> ì „ì²´ ë¬¼í’ˆ ëª©ë¡</h2>
                                        <div className="flex items-center gap-2">
                                            <button onClick={downloadExcel} className="px-3 py-1.5 rounded-lg text-sm font-bold border flex items-center gap-1 bg-green-50 text-green-700 border-green-200 hover:bg-green-100">
                                                <FileSpreadsheet size={14}/> ì—‘ì…€(CSV) ì €ì¥
                                            </button>
                                            <button onClick={uploadInitialData} disabled={uploading || isOffline} className={`px-3 py-1.5 rounded-lg text-sm font-bold border flex items-center gap-1 mr-2 ${isOffline ? 'bg-gray-100 text-gray-400 border-gray-200' : 'bg-indigo-50 text-indigo-600 border-indigo-200 hover:bg-indigo-100'}`}>
                                                {uploading ? <RefreshCw className="animate-spin" size={14}/> : <UploadCloud size={14}/>} ì´ˆê¸° ë°ì´í„° ì—…ë¡œë“œ
                                            </button>
                                            <div className="flex gap-2">
                                                <button onClick={() => setRoomFilter('all')} className={`px-3 py-1.5 rounded-lg text-sm font-bold border ${roomFilter === 'all' ? 'bg-slate-800 text-white' : 'bg-white text-slate-600'}`}>ì „ì²´</button>
                                                <button onClick={() => setRoomFilter('1ê³¼í•™ì‹¤')} className={`px-3 py-1.5 rounded-lg text-sm font-bold border ${roomFilter === '1ê³¼í•™ì‹¤' ? 'bg-green-600 text-white' : 'bg-white text-slate-600'}`}>1ê³¼í•™ì‹¤</button>
                                                <button onClick={() => setRoomFilter('2ê³¼í•™ì‹¤')} className={`px-3 py-1.5 rounded-lg text-sm font-bold border ${roomFilter === '2ê³¼í•™ì‹¤' ? 'bg-blue-600 text-white' : 'bg-white text-slate-600'}`}>2ê³¼í•™ì‹¤</button>
                                            </div>
                                        </div>
                                    </div>
                                    {loading ? (<div className="py-20 text-center text-slate-400"><RefreshCw className="animate-spin mx-auto mb-2" size={32}/>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>) : (
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">{filteredInventory.map((item) => (<InventoryCard key={item.id} item={item} />))}{filteredInventory.length === 0 && (<div className="col-span-full text-center py-10 text-slate-400 border-2 border-dashed border-slate-200 rounded-xl">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. 'ì´ˆê¸° ë°ì´í„° ì—…ë¡œë“œ' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš” (ì˜¨ë¼ì¸ ëª¨ë“œì—ì„œë§Œ ê°€ëŠ¥).</div>)}</div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'experiments' && (
                            <div className="space-y-6 animate-fade-in">
                                <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                                    <h2 className="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2"><Beaker size={24} className="text-indigo-600"/> ë“±ë¡ëœ ì‹¤í—˜ ëª©ë¡</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {experiments.map((exp, idx) => (
                                            <button key={idx} onClick={() => { setSearchTerm(exp.name); setActiveTab('search'); }} className="flex flex-col text-left bg-slate-50 hover:bg-indigo-50 border border-slate-200 hover:border-indigo-200 rounded-xl p-5 transition-all group">
                                                <div className="flex justify-between items-start w-full mb-2"><h3 className="text-lg font-bold text-slate-700 group-hover:text-indigo-700">{exp.name}</h3><span className="text-xs font-bold bg-white text-slate-500 border border-slate-200 px-2 py-1 rounded-full group-hover:border-indigo-200 group-hover:text-indigo-600">{exp.grade}í•™ë…„</span></div>
                                                <p className="text-sm text-slate-500 group-hover:text-slate-600">{exp.tools.join(', ')}</p>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                        <div className="mt-8 text-center text-slate-400 text-sm pb-8"><p>Â© 2025 ë¹„ë¹„ë“œ</p></div>
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>